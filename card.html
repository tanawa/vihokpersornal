<!DOCTYPE html>
<html>
<head>
	<title>ระบบทำบัตร</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
	<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<style type="text/css">
		canvas{
			border:2px solid #000;
			margin: 10px;
		}
	</style>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div id="nav">
		<a href="index.html">ฝ่ายบุคคล<a href="money.html">ฝ่ายการเงิน</a><a href="radio.html">ฝ่ายเทคนิค</a><a href="canvas.html">ระบบเซ็น</a><a href="card.html">ระบบทำบัตร</a>
	</div>
	<center>

	<br>
<table>
	
	<tr><td><canvas id="canvas" width="325px" height="512px">
	
</canvas></td><td><center>

	<input type="text" name="" id="search" placeholder="หมายเลขวิหค"><button onclick="load()">ค้นหาข้อมูล</button><br>
	<button onclick="set()">แปลง canvas เป็น PNG</button><br>
<a id="down" download="บัตรวิหค.png" ><button>โหลดไฟล์ภาพ PNG</button></a></center></td></tr>
</table>
<br>

</center>
<script type="text/javascript">
	var canva=document.getElementById("canvas");
	var firebaseConfig = {
    apiKey: "AIzaSyAS8FVZdUsHQykpoZEB-uAHRHQYSLPnatg",
    authDomain: "testmes-2fcf4.firebaseapp.com",
    databaseURL: "https://testmes-2fcf4.firebaseio.com",
    projectId: "testmes-2fcf4",
    storageBucket: "testmes-2fcf4.appspot.com",
    messagingSenderId: "866846768783",
    appId: "1:866846768783:web:6ef7269027340cfc"
  };
  firebase.initializeApp(firebaseConfig);
  var ref=firebase.database().ref();
  var data="";
  var canvas=canva.getContext("2d");
	var img=new Image();
	img.onload=function(){
		canvas.drawImage(img,0,0,325,512);
		
	}
	img.src="page.png";



  function load(){

    ref=firebase.database().ref("name/vihok1/"+$("#search").val());
    ref.on("value",function(snapshot){
    	
	img.onload=function(){
		canvas.drawImage(img,0,0,325,512);
		canvas.font = "16px sans-serif";
		canvas.fillStyle='#fff';
		canvas.fillText(snapshot.val()[0].split(" ")[0],70,340);
		canvas.fillText(snapshot.val()[0].split(" ")[1],220,340);
		canvas.fillText(snapshot.val()[5],220,365);
		canvas.fillText(snapshot.val()[2],120,392);
	}
	img.src="page.png";
	
    },function(error){

    });
	
  }
function set(){
	var data=canva.toDataURL("image/png");
	console.log(data);
	document.getElementById("down").href=data;
	swal("แจ้งเตือน","โหลดไฟล์สำเร็จ","success");
	
}
</script>
</body>
</html>